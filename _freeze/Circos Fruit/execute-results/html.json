{
  "hash": "4f542d1cf1e2dd92413f286d63b10b77",
  "result": {
    "markdown": "# Circos Fruit\n::: {.callout-tip}\nEnhanced visualization integrating differential gene analysis, pathway-level GSVA (Gene Set Variation Analysis), and ssGSEA (single-sample Gene Set Enrichment Analysis).\n:::\n\n\n\n\n\n```r \nlibrary(TransProR)\nlibrary(org.Hs.eg.db)\nlibrary(clusterProfiler)\nlibrary(tidyr)\nlibrary(dplyr)\nlibrary(ggtree)\nlibrary(ggplot2)\n```\n\n\n## Load data\n\n::: {.cell}\n\n```{.r .cell-code}\ntumor <- readRDS(\"../test_TransProR/generated_data1/removebatch_SKCM_Skin_TCGA_exp_tumor.rds\")\nnormal <- readRDS('../test_TransProR/generated_data1/removebatch_SKCM_Skin_Normal_TCGA_GTEX_count.rds')\n# Merge the datasets, ensuring both have genes as row names\nall_count_exp <- merge(tumor, normal, by = \"row.names\")\nall_count_exp <- tibble::column_to_rownames(all_count_exp, var = \"Row.names\")  # Set the row names\n\n# Drawing data\n# all_count_exp <- log_transform(all_count_exp)\nDEG_deseq2 <- readRDS('../test_TransProR/Select DEGs/DEG_deseq2.Rdata')\n#head(all_count_exp, 1)\nhead(DEG_deseq2, 5)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n          baseMean log2FoldChange      lfcSE      stat pvalue padj change\nA1BG      134.6084      -2.549682 0.05677219 -44.91075      0    0   down\nA2M     30208.9912       3.251168 0.08394645  38.72907      0    0     up\nAADACL2   801.4538      -8.229956 0.18969649 -43.38486      0    0   down\nAARS2    1153.5493       1.624753 0.03283522  49.48202      0    0 stable\nAARSD1    567.8672      -2.082289 0.02275703 -91.50088      0    0 stable\n```\n:::\n:::\n\n\n## Convert from SYMBOL to ENTREZID\n\n::: {.cell}\n\n```{.r .cell-code}\n# Convert from SYMBOL to ENTREZID for convenient enrichment analysis later. It's crucial to do this now as a direct conversion may result in a reduced set of genes due to non-one-to-one correspondence.\n\n# DEG_deseq2\n# Retrieve gene list\ngene <- rownames(DEG_deseq2)\n# Perform conversion\ngene = bitr(gene, fromType=\"SYMBOL\", toType=\"ENTREZID\", OrgDb=\"org.Hs.eg.db\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n'select()' returned 1:many mapping between keys and columns\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in bitr(gene, fromType = \"SYMBOL\", toType = \"ENTREZID\", OrgDb =\n\"org.Hs.eg.db\"): 43.37% of input gene IDs are fail to map...\n```\n:::\n\n```{.r .cell-code}\n# Remove duplicates and merge\ngene <- dplyr::distinct(gene, SYMBOL, .keep_all=TRUE)\n# Extract the SYMBOL column as a vector from the first dataset\nsymbols_vector <- gene$SYMBOL\n# Use the SYMBOL column to filter corresponding rows from the second dataset by row names\nDEG_deseq2 <- DEG_deseq2[rownames(DEG_deseq2) %in% symbols_vector, ]\nhead(DEG_deseq2, 5)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n          baseMean log2FoldChange      lfcSE      stat pvalue padj change\nA1BG      134.6084      -2.549682 0.05677219 -44.91075      0    0   down\nA2M     30208.9912       3.251168 0.08394645  38.72907      0    0     up\nAADACL2   801.4538      -8.229956 0.18969649 -43.38486      0    0   down\nAARS2    1153.5493       1.624753 0.03283522  49.48202      0    0 stable\nAARSD1    567.8672      -2.082289 0.02275703 -91.50088      0    0 stable\n```\n:::\n:::\n\n\n## Select differentially expressed genes\n\n::: {.cell}\n\n```{.r .cell-code}\nDiff_deseq2 <- filter_diff_genes(\n  DEG_deseq2, \n  p_val_col = \"pvalue\", \n  log_fc_col = \"log2FoldChange\",\n  p_val_threshold = 0.05, \n  log_fc_threshold = 3\n  )\n# First, obtain a list of gene names from the row names of the first dataset\ngene_names <- rownames(Diff_deseq2)\n# Find the matching rows in the second dataframe\nmatched_rows <- all_count_exp[gene_names, ]\n# Calculate the mean for each row\naverages <- rowMeans(matched_rows, na.rm = TRUE)\n# Append the averages as a new column to the first dataframe\nDiff_deseq2$average <- averages\nDiff_deseq2$ID <- rownames(Diff_deseq2)\nDiff_deseq2$changetype <- ifelse(Diff_deseq2$change == 'up', 1, -1)\n# Define a small threshold value\nsmall_value <- .Machine$double.xmin\n# Before calculating -log10, replace zeroes with the small threshold value and assign it to a new column\nDiff_deseq2$log_pvalue <- ifelse(Diff_deseq2$pvalue == 0, -log10(small_value), -log10(Diff_deseq2$pvalue))\n# Extract the expression data corresponding to the differentially expressed genes\nheatdata_deseq2 <- all_count_exp[rownames(Diff_deseq2), ]\n#head(heatdata_deseq2, 1)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123)\n# Preparing heatdata for visualization\nHeatdataDeseq2 <- TransProR::process_heatdata(heatdata_deseq2, \n                                              selection = 2, \n                                              custom_names = NULL, \n                                              num_names_per_group = 60, \n                                              prefix_length = 4)\nHeatdataDeseq2 <- as.matrix(HeatdataDeseq2)\n\nlibrary(msigdbr)\n## Using the msigdbr package to download and prepare for GSVA analysis with KEGG and GO gene sets\n## KEGG\nKEGG_df_all <- msigdbr(species = \"Homo sapiens\", # Homo sapiens or Mus musculus\n                        category = \"C2\",\n                        subcategory = \"CP:KEGG\") \nKEGG_df <- dplyr::select(KEGG_df_all, gs_name, gs_exact_source, gene_symbol)\nkegg_list <- split(KEGG_df$gene_symbol, KEGG_df$gs_name) # Grouping gene symbols by gs_name\nhead(kegg_list)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n$KEGG_ABC_TRANSPORTERS\n [1] \"ABCA1\"  \"ABCA10\" \"ABCA12\" \"ABCA13\" \"ABCA2\"  \"ABCA3\"  \"ABCA4\"  \"ABCA5\" \n [9] \"ABCA6\"  \"ABCA7\"  \"ABCA8\"  \"ABCA9\"  \"ABCB1\"  \"ABCB10\" \"ABCB11\" \"ABCB11\"\n[17] \"ABCB4\"  \"ABCB5\"  \"ABCB6\"  \"ABCB7\"  \"ABCB8\"  \"ABCB9\"  \"ABCC1\"  \"ABCC1\" \n[25] \"ABCC10\" \"ABCC11\" \"ABCC12\" \"ABCC2\"  \"ABCC3\"  \"ABCC4\"  \"ABCC5\"  \"ABCC6\" \n[33] \"ABCC6\"  \"ABCC8\"  \"ABCC9\"  \"ABCD1\"  \"ABCD2\"  \"ABCD3\"  \"ABCD4\"  \"ABCG1\" \n[41] \"ABCG2\"  \"ABCG4\"  \"ABCG5\"  \"ABCG8\"  \"CFTR\"   \"TAP1\"   \"TAP1\"   \"TAP1\"  \n[49] \"TAP1\"   \"TAP1\"   \"TAP1\"   \"TAP1\"   \"TAP1\"   \"TAP2\"   \"TAP2\"   \"TAP2\"  \n[57] \"TAP2\"   \"TAP2\"   \"TAP2\"   \"TAP2\"   \"TAP2\"  \n\n$KEGG_ACUTE_MYELOID_LEUKEMIA\n [1] \"AKT1\"     \"AKT2\"     \"AKT3\"     \"AKT3\"     \"ARAF\"     \"BAD\"     \n [7] \"BRAF\"     \"CCNA1\"    \"CCND1\"    \"CEBPA\"    \"CHUK\"     \"EIF4EBP1\"\n[13] \"FLT3\"     \"GRB2\"     \"HRAS\"     \"HRAS\"     \"IKBKB\"    \"IKBKG\"   \n[19] \"JUP\"      \"KIT\"      \"KRAS\"     \"LEF1\"     \"MAP2K1\"   \"MAP2K2\"  \n[25] \"MAPK1\"    \"MAPK3\"    \"MTOR\"     \"MYC\"      \"NFKB1\"    \"NRAS\"    \n[31] \"PIK3CA\"   \"PIK3CB\"   \"PIK3CD\"   \"PIK3CG\"   \"PIK3R1\"   \"PIK3R2\"  \n[37] \"PIK3R3\"   \"PIK3R5\"   \"PIM1\"     \"PIM2\"     \"PML\"      \"PPARD\"   \n[43] \"RAF1\"     \"RARA\"     \"RELA\"     \"RPS6KB1\"  \"RPS6KB2\"  \"RUNX1\"   \n[49] \"RUNX1T1\"  \"SOS1\"     \"SOS2\"     \"SPI1\"     \"STAT3\"    \"STAT5A\"  \n[55] \"STAT5B\"   \"TCF7\"     \"TCF7L1\"   \"TCF7L2\"   \"ZBTB16\"  \n\n$KEGG_ADHERENS_JUNCTION\n [1] \"ACP1\"    \"ACTB\"    \"ACTG1\"   \"ACTN1\"   \"ACTN2\"   \"ACTN3\"   \"ACTN4\"  \n [8] \"ACTN4\"   \"AFDN\"    \"BAIAP2\"  \"CDC42\"   \"CDH1\"    \"CREBBP\"  \"CSNK2A1\"\n[15] \"CSNK2A2\" \"CSNK2B\"  \"CSNK2B\"  \"CSNK2B\"  \"CSNK2B\"  \"CSNK2B\"  \"CSNK2B\" \n[22] \"CSNK2B\"  \"CSNK2B\"  \"CTNNA1\"  \"CTNNA2\"  \"CTNNA3\"  \"CTNNB1\"  \"CTNND1\" \n[29] \"EGFR\"    \"EP300\"   \"ERBB2\"   \"FARP2\"   \"FER\"     \"FGFR1\"   \"FYN\"    \n[36] \"IGF1R\"   \"INSR\"    \"IQGAP1\"  \"LEF1\"    \"LMO7\"    \"MAP3K7\"  \"MAPK1\"  \n[43] \"MAPK3\"   \"MET\"     \"NECTIN1\" \"NECTIN2\" \"NECTIN3\" \"NECTIN4\" \"NLK\"    \n[50] \"PARD3\"   \"PTPN1\"   \"PTPN6\"   \"PTPRB\"   \"PTPRF\"   \"PTPRJ\"   \"PTPRM\"  \n[57] \"RAC1\"    \"RAC2\"    \"RAC3\"    \"RHOA\"    \"SMAD2\"   \"SMAD3\"   \"SMAD4\"  \n[64] \"SNAI1\"   \"SNAI2\"   \"SORBS1\"  \"SRC\"     \"SSX2IP\"  \"TCF7\"    \"TCF7L1\" \n[71] \"TCF7L2\"  \"TGFBR1\"  \"TGFBR2\"  \"TJP1\"    \"TJP1\"    \"VCL\"     \"WAS\"    \n[78] \"WASF1\"   \"WASF2\"   \"WASF3\"   \"WASL\"    \"YES1\"   \n\n$KEGG_ADIPOCYTOKINE_SIGNALING_PATHWAY\n [1] \"ACACB\"    \"ACSL1\"    \"ACSL3\"    \"ACSL4\"    \"ACSL5\"    \"ACSL6\"   \n [7] \"ADIPOQ\"   \"ADIPOR1\"  \"ADIPOR2\"  \"ADIPOR2\"  \"AGRP\"     \"AKT1\"    \n[13] \"AKT2\"     \"AKT3\"     \"AKT3\"     \"CAMKK1\"   \"CAMKK2\"   \"CD36\"    \n[19] \"CHUK\"     \"CPT1A\"    \"CPT1B\"    \"CPT1C\"    \"G6PC1\"    \"G6PC2\"   \n[25] \"G6PC2\"    \"IKBKB\"    \"IKBKG\"    \"IRS1\"     \"IRS2\"     \"IRS4\"    \n[31] \"JAK2\"     \"LEP\"      \"LEPR\"     \"MAPK10\"   \"MAPK8\"    \"MAPK9\"   \n[37] \"MTOR\"     \"NFKB1\"    \"NFKBIA\"   \"NFKBIB\"   \"NFKBIB\"   \"NFKBIE\"  \n[43] \"NPY\"      \"PCK1\"     \"PCK2\"     \"PCK2\"     \"POMC\"     \"PPARA\"   \n[49] \"PPARGC1A\" \"PRKAA1\"   \"PRKAA2\"   \"PRKAB1\"   \"PRKAB2\"   \"PRKAG1\"  \n[55] \"PRKAG2\"   \"PRKAG3\"   \"PRKCQ\"    \"PTPN11\"   \"RELA\"     \"RXRA\"    \n[61] \"RXRB\"     \"RXRB\"     \"RXRB\"     \"RXRB\"     \"RXRB\"     \"RXRB\"    \n[67] \"RXRG\"     \"SLC2A1\"   \"SLC2A4\"   \"SLC2A4\"   \"SOCS3\"    \"STAT3\"   \n[73] \"STK11\"    \"TNF\"      \"TNF\"      \"TNF\"      \"TNF\"      \"TNF\"     \n[79] \"TNF\"      \"TNF\"      \"TNF\"      \"TNFRSF1A\" \"TNFRSF1B\" \"TRADD\"   \n[85] \"TRAF2\"   \n\n$KEGG_ALANINE_ASPARTATE_AND_GLUTAMATE_METABOLISM\n [1] \"ABAT\"    \"ACY3\"    \"ADSL\"    \"ADSS1\"   \"ADSS2\"   \"AGXT\"    \"AGXT2\"  \n [8] \"ALDH4A1\" \"ALDH5A1\" \"ASL\"     \"ASNS\"    \"ASPA\"    \"ASS1\"    \"CAD\"    \n[15] \"CPS1\"    \"DDO\"     \"GAD1\"    \"GAD2\"    \"GFPT1\"   \"GFPT2\"   \"GLS\"    \n[22] \"GLS2\"    \"GLUD1\"   \"GLUD2\"   \"GLUD2\"   \"GLUL\"    \"GOT1\"    \"GOT2\"   \n[29] \"GPT\"     \"GPT2\"    \"IL4I1\"   \"NIT2\"    \"PPAT\"   \n\n$KEGG_ALDOSTERONE_REGULATED_SODIUM_REABSORPTION\n [1] \"ATP1A1\"   \"ATP1A2\"   \"ATP1A3\"   \"ATP1A4\"   \"ATP1B1\"   \"ATP1B2\"  \n [7] \"ATP1B3\"   \"ATP1B4\"   \"FXYD2\"    \"FXYD4\"    \"HSD11B1\"  \"HSD11B2\" \n[13] \"IGF1\"     \"INS\"      \"INSR\"     \"IRS1\"     \"IRS2\"     \"IRS4\"    \n[19] \"KCNJ1\"    \"KRAS\"     \"MAPK1\"    \"MAPK3\"    \"NEDD4L\"   \"NR3C2\"   \n[25] \"PDPK1\"    \"PIK3CA\"   \"PIK3CB\"   \"PIK3CD\"   \"PIK3CG\"   \"PIK3R1\"  \n[31] \"PIK3R2\"   \"PIK3R3\"   \"PIK3R5\"   \"PRKCA\"    \"PRKCB\"    \"PRKCG\"   \n[37] \"SCNN1A\"   \"SCNN1B\"   \"SCNN1G\"   \"SFN\"      \"SGK1\"     \"SLC9A3R2\"\n```\n:::\n\n```{.r .cell-code}\n## GO\nGO_df_all <- msigdbr(species = \"Homo sapiens\",\n                      category = \"C5\")  \nGO_df <- dplyr::select(GO_df_all, gs_name, gene_symbol, gs_exact_source, gs_subcat)\nGO_df <- GO_df[GO_df$gs_subcat != \"HPO\",]\ngo_list <- split(GO_df$gene_symbol, GO_df$gs_name) # Grouping gene symbols by gs_name\nhead(go_list)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n$GOBP_10_FORMYLTETRAHYDROFOLATE_METABOLIC_PROCESS\n[1] \"AASDHPPT\" \"ALDH1L1\"  \"ALDH1L2\"  \"MTHFD1\"   \"MTHFD1L\"  \"MTHFD2L\" \n\n$GOBP_2_OXOGLUTARATE_METABOLIC_PROCESS\n [1] \"AADAT\"  \"ADHFE1\" \"D2HGDH\" \"DLST\"   \"GOT1\"   \"GOT2\"   \"GPT2\"   \"IDH1\"  \n [9] \"IDH2\"   \"IDH3B\"  \"KYAT3\"  \"L2HGDH\" \"MRPS36\" \"MRPS36\" \"OGDH\"   \"OGDHL\" \n[17] \"PHYH\"   \"TAT\"   \n\n$GOBP_2FE_2S_CLUSTER_ASSEMBLY\n[1] \"BOLA2\"  \"BOLA2B\" \"GLRX3\"  \"GLRX5\"  \"HSCB\"   \"NFS1\"  \n\n$GOBP_3_PHOSPHOADENOSINE_5_PHOSPHOSULFATE_BIOSYNTHETIC_PROCESS\n[1] \"PAPSS1\"  \"PAPSS2\"  \"SLC26A1\" \"SLC26A2\" \"SLC35B2\" \"SLC35B3\"\n\n$GOBP_3_PHOSPHOADENOSINE_5_PHOSPHOSULFATE_METABOLIC_PROCESS\n [1] \"ABHD14B\" \"BPNT1\"   \"ENPP1\"   \"PAPSS1\"  \"PAPSS2\"  \"SLC26A1\" \"SLC26A2\"\n [8] \"SLC35B2\" \"SLC35B3\" \"SULT1A1\" \"SULT1A2\" \"SULT1A3\" \"SULT1A4\" \"SULT1B1\"\n[15] \"SULT1C3\" \"SULT1C4\" \"SULT1E1\" \"SULT2A1\" \"SULT2B1\" \"TPST1\"   \"TPST2\"  \n\n$GOBP_3_UTR_MEDIATED_MRNA_DESTABILIZATION\n [1] \"CPEB3\"   \"DHX36\"   \"DHX36\"   \"DND1\"    \"DND1\"    \"HNRNPD\"  \"KHSRP\"  \n [8] \"MOV10\"   \"PLEKHN1\" \"RBM24\"   \"RC3H1\"   \"TARDBP\"  \"TRIM71\"  \"UPF1\"   \n[15] \"ZC3H12A\" \"ZC3H12D\" \"ZFP36\"   \"ZFP36L1\" \"ZFP36L2\"\n```\n:::\n\n```{.r .cell-code}\nlibrary(GSVA)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'GSVA' was built under R version 4.3.3\n```\n:::\n\n```{.r .cell-code}\ngsva_kegg <- gsva(expr = HeatdataDeseq2, \n                  gset.idx.list = kegg_list, \n                  kcdf = \"Poisson\", #\"Gaussian\" for logCPM, logRPKM, logTPM, \"Poisson\" for counts\n                  verbose = TRUE\n                  #parallel.sz = parallel::detectCores() # Utilize all available cores\n                  )\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Calling gsva(expr=., gset.idx.list=., method=., ...) is deprecated;\nuse a method-specific parameter object (see '?gsva').\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in .gsva(expr, mapped.gset.idx.list, method, kcdf, rnaseq, abs.ranking,\n: Some gene sets have size one. Consider setting 'min.sz > 1'.\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\nEstimating GSVA scores for 171 gene sets.\nEstimating ECDFs with Poisson kernels\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |                                                                      |   1%\n  |                                                                            \n  |=                                                                     |   1%\n  |                                                                            \n  |=                                                                     |   2%\n  |                                                                            \n  |==                                                                    |   2%\n  |                                                                            \n  |==                                                                    |   3%\n  |                                                                            \n  |==                                                                    |   4%\n  |                                                                            \n  |===                                                                   |   4%\n  |                                                                            \n  |===                                                                   |   5%\n  |                                                                            \n  |====                                                                  |   5%\n  |                                                                            \n  |====                                                                  |   6%\n  |                                                                            \n  |=====                                                                 |   6%\n  |                                                                            \n  |=====                                                                 |   7%\n  |                                                                            \n  |=====                                                                 |   8%\n  |                                                                            \n  |======                                                                |   8%\n  |                                                                            \n  |======                                                                |   9%\n  |                                                                            \n  |=======                                                               |   9%\n  |                                                                            \n  |=======                                                               |  10%\n  |                                                                            \n  |=======                                                               |  11%\n  |                                                                            \n  |========                                                              |  11%\n  |                                                                            \n  |========                                                              |  12%\n  |                                                                            \n  |=========                                                             |  12%\n  |                                                                            \n  |=========                                                             |  13%\n  |                                                                            \n  |==========                                                            |  14%\n  |                                                                            \n  |==========                                                            |  15%\n  |                                                                            \n  |===========                                                           |  15%\n  |                                                                            \n  |===========                                                           |  16%\n  |                                                                            \n  |============                                                          |  17%\n  |                                                                            \n  |============                                                          |  18%\n  |                                                                            \n  |=============                                                         |  18%\n  |                                                                            \n  |=============                                                         |  19%\n  |                                                                            \n  |==============                                                        |  19%\n  |                                                                            \n  |==============                                                        |  20%\n  |                                                                            \n  |===============                                                       |  21%\n  |                                                                            \n  |===============                                                       |  22%\n  |                                                                            \n  |================                                                      |  22%\n  |                                                                            \n  |================                                                      |  23%\n  |                                                                            \n  |=================                                                     |  24%\n  |                                                                            \n  |=================                                                     |  25%\n  |                                                                            \n  |==================                                                    |  25%\n  |                                                                            \n  |==================                                                    |  26%\n  |                                                                            \n  |===================                                                   |  27%\n  |                                                                            \n  |====================                                                  |  28%\n  |                                                                            \n  |====================                                                  |  29%\n  |                                                                            \n  |=====================                                                 |  30%\n  |                                                                            \n  |======================                                                |  31%\n  |                                                                            \n  |======================                                                |  32%\n  |                                                                            \n  |=======================                                               |  32%\n  |                                                                            \n  |=======================                                               |  33%\n  |                                                                            \n  |========================                                              |  34%\n  |                                                                            \n  |========================                                              |  35%\n  |                                                                            \n  |=========================                                             |  35%\n  |                                                                            \n  |=========================                                             |  36%\n  |                                                                            \n  |==========================                                            |  37%\n  |                                                                            \n  |===========================                                           |  38%\n  |                                                                            \n  |===========================                                           |  39%\n  |                                                                            \n  |============================                                          |  40%\n  |                                                                            \n  |=============================                                         |  41%\n  |                                                                            \n  |=============================                                         |  42%\n  |                                                                            \n  |==============================                                        |  43%\n  |                                                                            \n  |===============================                                       |  44%\n  |                                                                            \n  |================================                                      |  45%\n  |                                                                            \n  |================================                                      |  46%\n  |                                                                            \n  |=================================                                     |  47%\n  |                                                                            \n  |==================================                                    |  48%\n  |                                                                            \n  |==================================                                    |  49%\n  |                                                                            \n  |===================================                                   |  50%\n  |                                                                            \n  |====================================                                  |  51%\n  |                                                                            \n  |====================================                                  |  52%\n  |                                                                            \n  |=====================================                                 |  53%\n  |                                                                            \n  |======================================                                |  54%\n  |                                                                            \n  |======================================                                |  55%\n  |                                                                            \n  |=======================================                               |  56%\n  |                                                                            \n  |========================================                              |  57%\n  |                                                                            \n  |=========================================                             |  58%\n  |                                                                            \n  |=========================================                             |  59%\n  |                                                                            \n  |==========================================                            |  60%\n  |                                                                            \n  |===========================================                           |  61%\n  |                                                                            \n  |===========================================                           |  62%\n  |                                                                            \n  |============================================                          |  63%\n  |                                                                            \n  |=============================================                         |  64%\n  |                                                                            \n  |=============================================                         |  65%\n  |                                                                            \n  |==============================================                        |  65%\n  |                                                                            \n  |==============================================                        |  66%\n  |                                                                            \n  |===============================================                       |  67%\n  |                                                                            \n  |===============================================                       |  68%\n  |                                                                            \n  |================================================                      |  68%\n  |                                                                            \n  |================================================                      |  69%\n  |                                                                            \n  |=================================================                     |  70%\n  |                                                                            \n  |==================================================                    |  71%\n  |                                                                            \n  |==================================================                    |  72%\n  |                                                                            \n  |===================================================                   |  73%\n  |                                                                            \n  |====================================================                  |  74%\n  |                                                                            \n  |====================================================                  |  75%\n  |                                                                            \n  |=====================================================                 |  75%\n  |                                                                            \n  |=====================================================                 |  76%\n  |                                                                            \n  |======================================================                |  77%\n  |                                                                            \n  |======================================================                |  78%\n  |                                                                            \n  |=======================================================               |  78%\n  |                                                                            \n  |=======================================================               |  79%\n  |                                                                            \n  |========================================================              |  80%\n  |                                                                            \n  |========================================================              |  81%\n  |                                                                            \n  |=========================================================             |  81%\n  |                                                                            \n  |=========================================================             |  82%\n  |                                                                            \n  |==========================================================            |  82%\n  |                                                                            \n  |==========================================================            |  83%\n  |                                                                            \n  |===========================================================           |  84%\n  |                                                                            \n  |===========================================================           |  85%\n  |                                                                            \n  |============================================================          |  85%\n  |                                                                            \n  |============================================================          |  86%\n  |                                                                            \n  |=============================================================         |  87%\n  |                                                                            \n  |=============================================================         |  88%\n  |                                                                            \n  |==============================================================        |  88%\n  |                                                                            \n  |==============================================================        |  89%\n  |                                                                            \n  |===============================================================       |  89%\n  |                                                                            \n  |===============================================================       |  90%\n  |                                                                            \n  |===============================================================       |  91%\n  |                                                                            \n  |================================================================      |  91%\n  |                                                                            \n  |================================================================      |  92%\n  |                                                                            \n  |=================================================================     |  92%\n  |                                                                            \n  |=================================================================     |  93%\n  |                                                                            \n  |=================================================================     |  94%\n  |                                                                            \n  |==================================================================    |  94%\n  |                                                                            \n  |==================================================================    |  95%\n  |                                                                            \n  |===================================================================   |  95%\n  |                                                                            \n  |===================================================================   |  96%\n  |                                                                            \n  |====================================================================  |  96%\n  |                                                                            \n  |====================================================================  |  97%\n  |                                                                            \n  |====================================================================  |  98%\n  |                                                                            \n  |===================================================================== |  98%\n  |                                                                            \n  |===================================================================== |  99%\n  |                                                                            \n  |======================================================================|  99%\n  |                                                                            \n  |======================================================================| 100%\n```\n:::\n\n```{.r .cell-code}\n#write.csv(gsva_mat, \"gsva_go_matrix.csv\")\n\ngsva_go <- gsva(expr = HeatdataDeseq2, \n                gset.idx.list = go_list, \n                kcdf = \"Poisson\", #\"Gaussian\" for logCPM, logRPKM, logTPM, \"Poisson\" for counts\n                verbose = TRUE\n                #parallel.sz = parallel::detectCores() # Utilize all available cores\n                )\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Calling gsva(expr=., gset.idx.list=., method=., ...) is deprecated;\nuse a method-specific parameter object (see '?gsva').\nWarning: Some gene sets have size one. Consider setting 'min.sz > 1'.\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\nEstimating GSVA scores for 7997 gene sets.\nEstimating ECDFs with Poisson kernels\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |                                                                      |   1%\n  |                                                                            \n  |=                                                                     |   1%\n  |                                                                            \n  |=                                                                     |   2%\n  |                                                                            \n  |==                                                                    |   2%\n  |                                                                            \n  |==                                                                    |   3%\n  |                                                                            \n  |==                                                                    |   4%\n  |                                                                            \n  |===                                                                   |   4%\n  |                                                                            \n  |===                                                                   |   5%\n  |                                                                            \n  |====                                                                  |   5%\n  |                                                                            \n  |====                                                                  |   6%\n  |                                                                            \n  |=====                                                                 |   6%\n  |                                                                            \n  |=====                                                                 |   7%\n  |                                                                            \n  |=====                                                                 |   8%\n  |                                                                            \n  |======                                                                |   8%\n  |                                                                            \n  |======                                                                |   9%\n  |                                                                            \n  |=======                                                               |   9%\n  |                                                                            \n  |=======                                                               |  10%\n  |                                                                            \n  |=======                                                               |  11%\n  |                                                                            \n  |========                                                              |  11%\n  |                                                                            \n  |========                                                              |  12%\n  |                                                                            \n  |=========                                                             |  12%\n  |                                                                            \n  |=========                                                             |  13%\n  |                                                                            \n  |=========                                                             |  14%\n  |                                                                            \n  |==========                                                            |  14%\n  |                                                                            \n  |==========                                                            |  15%\n  |                                                                            \n  |===========                                                           |  15%\n  |                                                                            \n  |===========                                                           |  16%\n  |                                                                            \n  |============                                                          |  16%\n  |                                                                            \n  |============                                                          |  17%\n  |                                                                            \n  |============                                                          |  18%\n  |                                                                            \n  |=============                                                         |  18%\n  |                                                                            \n  |=============                                                         |  19%\n  |                                                                            \n  |==============                                                        |  19%\n  |                                                                            \n  |==============                                                        |  20%\n  |                                                                            \n  |==============                                                        |  21%\n  |                                                                            \n  |===============                                                       |  21%\n  |                                                                            \n  |===============                                                       |  22%\n  |                                                                            \n  |================                                                      |  22%\n  |                                                                            \n  |================                                                      |  23%\n  |                                                                            \n  |================                                                      |  24%\n  |                                                                            \n  |=================                                                     |  24%\n  |                                                                            \n  |=================                                                     |  25%\n  |                                                                            \n  |==================                                                    |  25%\n  |                                                                            \n  |==================                                                    |  26%\n  |                                                                            \n  |===================                                                   |  26%\n  |                                                                            \n  |===================                                                   |  27%\n  |                                                                            \n  |===================                                                   |  28%\n  |                                                                            \n  |====================                                                  |  28%\n  |                                                                            \n  |====================                                                  |  29%\n  |                                                                            \n  |=====================                                                 |  29%\n  |                                                                            \n  |=====================                                                 |  30%\n  |                                                                            \n  |=====================                                                 |  31%\n  |                                                                            \n  |======================                                                |  31%\n  |                                                                            \n  |======================                                                |  32%\n  |                                                                            \n  |=======================                                               |  32%\n  |                                                                            \n  |=======================                                               |  33%\n  |                                                                            \n  |=======================                                               |  34%\n  |                                                                            \n  |========================                                              |  34%\n  |                                                                            \n  |========================                                              |  35%\n  |                                                                            \n  |=========================                                             |  35%\n  |                                                                            \n  |=========================                                             |  36%\n  |                                                                            \n  |==========================                                            |  36%\n  |                                                                            \n  |==========================                                            |  37%\n  |                                                                            \n  |==========================                                            |  38%\n  |                                                                            \n  |===========================                                           |  38%\n  |                                                                            \n  |===========================                                           |  39%\n  |                                                                            \n  |============================                                          |  39%\n  |                                                                            \n  |============================                                          |  40%\n  |                                                                            \n  |============================                                          |  41%\n  |                                                                            \n  |=============================                                         |  41%\n  |                                                                            \n  |=============================                                         |  42%\n  |                                                                            \n  |==============================                                        |  42%\n  |                                                                            \n  |==============================                                        |  43%\n  |                                                                            \n  |==============================                                        |  44%\n  |                                                                            \n  |===============================                                       |  44%\n  |                                                                            \n  |===============================                                       |  45%\n  |                                                                            \n  |================================                                      |  45%\n  |                                                                            \n  |================================                                      |  46%\n  |                                                                            \n  |=================================                                     |  46%\n  |                                                                            \n  |=================================                                     |  47%\n  |                                                                            \n  |=================================                                     |  48%\n  |                                                                            \n  |==================================                                    |  48%\n  |                                                                            \n  |==================================                                    |  49%\n  |                                                                            \n  |===================================                                   |  49%\n  |                                                                            \n  |===================================                                   |  50%\n  |                                                                            \n  |===================================                                   |  51%\n  |                                                                            \n  |====================================                                  |  51%\n  |                                                                            \n  |====================================                                  |  52%\n  |                                                                            \n  |=====================================                                 |  52%\n  |                                                                            \n  |=====================================                                 |  53%\n  |                                                                            \n  |=====================================                                 |  54%\n  |                                                                            \n  |======================================                                |  54%\n  |                                                                            \n  |======================================                                |  55%\n  |                                                                            \n  |=======================================                               |  55%\n  |                                                                            \n  |=======================================                               |  56%\n  |                                                                            \n  |========================================                              |  56%\n  |                                                                            \n  |========================================                              |  57%\n  |                                                                            \n  |========================================                              |  58%\n  |                                                                            \n  |=========================================                             |  58%\n  |                                                                            \n  |=========================================                             |  59%\n  |                                                                            \n  |==========================================                            |  59%\n  |                                                                            \n  |==========================================                            |  60%\n  |                                                                            \n  |==========================================                            |  61%\n  |                                                                            \n  |===========================================                           |  61%\n  |                                                                            \n  |===========================================                           |  62%\n  |                                                                            \n  |============================================                          |  62%\n  |                                                                            \n  |============================================                          |  63%\n  |                                                                            \n  |============================================                          |  64%\n  |                                                                            \n  |=============================================                         |  64%\n  |                                                                            \n  |=============================================                         |  65%\n  |                                                                            \n  |==============================================                        |  65%\n  |                                                                            \n  |==============================================                        |  66%\n  |                                                                            \n  |===============================================                       |  66%\n  |                                                                            \n  |===============================================                       |  67%\n  |                                                                            \n  |===============================================                       |  68%\n  |                                                                            \n  |================================================                      |  68%\n  |                                                                            \n  |================================================                      |  69%\n  |                                                                            \n  |=================================================                     |  69%\n  |                                                                            \n  |=================================================                     |  70%\n  |                                                                            \n  |=================================================                     |  71%\n  |                                                                            \n  |==================================================                    |  71%\n  |                                                                            \n  |==================================================                    |  72%\n  |                                                                            \n  |===================================================                   |  72%\n  |                                                                            \n  |===================================================                   |  73%\n  |                                                                            \n  |===================================================                   |  74%\n  |                                                                            \n  |====================================================                  |  74%\n  |                                                                            \n  |====================================================                  |  75%\n  |                                                                            \n  |=====================================================                 |  75%\n  |                                                                            \n  |=====================================================                 |  76%\n  |                                                                            \n  |======================================================                |  76%\n  |                                                                            \n  |======================================================                |  77%\n  |                                                                            \n  |======================================================                |  78%\n  |                                                                            \n  |=======================================================               |  78%\n  |                                                                            \n  |=======================================================               |  79%\n  |                                                                            \n  |========================================================              |  79%\n  |                                                                            \n  |========================================================              |  80%\n  |                                                                            \n  |========================================================              |  81%\n  |                                                                            \n  |=========================================================             |  81%\n  |                                                                            \n  |=========================================================             |  82%\n  |                                                                            \n  |==========================================================            |  82%\n  |                                                                            \n  |==========================================================            |  83%\n  |                                                                            \n  |==========================================================            |  84%\n  |                                                                            \n  |===========================================================           |  84%\n  |                                                                            \n  |===========================================================           |  85%\n  |                                                                            \n  |============================================================          |  85%\n  |                                                                            \n  |============================================================          |  86%\n  |                                                                            \n  |=============================================================         |  86%\n  |                                                                            \n  |=============================================================         |  87%\n  |                                                                            \n  |=============================================================         |  88%\n  |                                                                            \n  |==============================================================        |  88%\n  |                                                                            \n  |==============================================================        |  89%\n  |                                                                            \n  |===============================================================       |  89%\n  |                                                                            \n  |===============================================================       |  90%\n  |                                                                            \n  |===============================================================       |  91%\n  |                                                                            \n  |================================================================      |  91%\n  |                                                                            \n  |================================================================      |  92%\n  |                                                                            \n  |=================================================================     |  92%\n  |                                                                            \n  |=================================================================     |  93%\n  |                                                                            \n  |=================================================================     |  94%\n  |                                                                            \n  |==================================================================    |  94%\n  |                                                                            \n  |==================================================================    |  95%\n  |                                                                            \n  |===================================================================   |  95%\n  |                                                                            \n  |===================================================================   |  96%\n  |                                                                            \n  |====================================================================  |  96%\n  |                                                                            \n  |====================================================================  |  97%\n  |                                                                            \n  |====================================================================  |  98%\n  |                                                                            \n  |===================================================================== |  98%\n  |                                                                            \n  |===================================================================== |  99%\n  |                                                                            \n  |======================================================================|  99%\n  |                                                                            \n  |======================================================================| 100%\n```\n:::\n\n```{.r .cell-code}\n#write.csv(gsva_mat, \"gsva_go_matrix.csv\")\n\nssgsea_kegg <- gsva(expr = HeatdataDeseq2, \n                    gset.idx.list = kegg_list, \n                    kcdf = \"Poisson\", #\"Gaussian\" for logCPM, logRPKM, logTPM, \"Poisson\" for counts\n                    method = \"ssgsea\",\n                    verbose = TRUE\n                    #parallel.sz = parallel::detectCores() # Utilize all available cores\n)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Calling gsva(expr=., gset.idx.list=., method=., ...) is deprecated;\nuse a method-specific parameter object (see '?gsva').\nWarning: Some gene sets have size one. Consider setting 'min.sz > 1'.\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\nEstimating ssGSEA scores for 171 gene sets.\n[1] \"Calculating ranks...\"\n[1] \"Calculating absolute values from ranks...\"\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |=                                                                     |   1%\n  |                                                                            \n  |=                                                                     |   2%\n  |                                                                            \n  |==                                                                    |   2%\n  |                                                                            \n  |==                                                                    |   3%\n  |                                                                            \n  |===                                                                   |   4%\n  |                                                                            \n  |====                                                                  |   5%\n  |                                                                            \n  |====                                                                  |   6%\n  |                                                                            \n  |=====                                                                 |   7%\n  |                                                                            \n  |=====                                                                 |   8%\n  |                                                                            \n  |======                                                                |   8%\n  |                                                                            \n  |======                                                                |   9%\n  |                                                                            \n  |=======                                                               |  10%\n  |                                                                            \n  |========                                                              |  11%\n  |                                                                            \n  |========                                                              |  12%\n  |                                                                            \n  |=========                                                             |  12%\n  |                                                                            \n  |=========                                                             |  13%\n  |                                                                            \n  |==========                                                            |  14%\n  |                                                                            \n  |==========                                                            |  15%\n  |                                                                            \n  |===========                                                           |  16%\n  |                                                                            \n  |============                                                          |  17%\n  |                                                                            \n  |============                                                          |  18%\n  |                                                                            \n  |=============                                                         |  18%\n  |                                                                            \n  |=============                                                         |  19%\n  |                                                                            \n  |==============                                                        |  20%\n  |                                                                            \n  |===============                                                       |  21%\n  |                                                                            \n  |===============                                                       |  22%\n  |                                                                            \n  |================                                                      |  22%\n  |                                                                            \n  |================                                                      |  23%\n  |                                                                            \n  |=================                                                     |  24%\n  |                                                                            \n  |==================                                                    |  25%\n  |                                                                            \n  |==================                                                    |  26%\n  |                                                                            \n  |===================                                                   |  27%\n  |                                                                            \n  |===================                                                   |  28%\n  |                                                                            \n  |====================                                                  |  28%\n  |                                                                            \n  |====================                                                  |  29%\n  |                                                                            \n  |=====================                                                 |  30%\n  |                                                                            \n  |======================                                                |  31%\n  |                                                                            \n  |======================                                                |  32%\n  |                                                                            \n  |=======================                                               |  32%\n  |                                                                            \n  |=======================                                               |  33%\n  |                                                                            \n  |========================                                              |  34%\n  |                                                                            \n  |========================                                              |  35%\n  |                                                                            \n  |=========================                                             |  36%\n  |                                                                            \n  |==========================                                            |  37%\n  |                                                                            \n  |==========================                                            |  38%\n  |                                                                            \n  |===========================                                           |  38%\n  |                                                                            \n  |===========================                                           |  39%\n  |                                                                            \n  |============================                                          |  40%\n  |                                                                            \n  |=============================                                         |  41%\n  |                                                                            \n  |=============================                                         |  42%\n  |                                                                            \n  |==============================                                        |  42%\n  |                                                                            \n  |==============================                                        |  43%\n  |                                                                            \n  |===============================                                       |  44%\n  |                                                                            \n  |================================                                      |  45%\n  |                                                                            \n  |================================                                      |  46%\n  |                                                                            \n  |=================================                                     |  47%\n  |                                                                            \n  |=================================                                     |  48%\n  |                                                                            \n  |==================================                                    |  48%\n  |                                                                            \n  |==================================                                    |  49%\n  |                                                                            \n  |===================================                                   |  50%\n  |                                                                            \n  |====================================                                  |  51%\n  |                                                                            \n  |====================================                                  |  52%\n  |                                                                            \n  |=====================================                                 |  52%\n  |                                                                            \n  |=====================================                                 |  53%\n  |                                                                            \n  |======================================                                |  54%\n  |                                                                            \n  |======================================                                |  55%\n  |                                                                            \n  |=======================================                               |  56%\n  |                                                                            \n  |========================================                              |  57%\n  |                                                                            \n  |========================================                              |  58%\n  |                                                                            \n  |=========================================                             |  58%\n  |                                                                            \n  |=========================================                             |  59%\n  |                                                                            \n  |==========================================                            |  60%\n  |                                                                            \n  |===========================================                           |  61%\n  |                                                                            \n  |===========================================                           |  62%\n  |                                                                            \n  |============================================                          |  62%\n  |                                                                            \n  |============================================                          |  63%\n  |                                                                            \n  |=============================================                         |  64%\n  |                                                                            \n  |==============================================                        |  65%\n  |                                                                            \n  |==============================================                        |  66%\n  |                                                                            \n  |===============================================                       |  67%\n  |                                                                            \n  |===============================================                       |  68%\n  |                                                                            \n  |================================================                      |  68%\n  |                                                                            \n  |================================================                      |  69%\n  |                                                                            \n  |=================================================                     |  70%\n  |                                                                            \n  |==================================================                    |  71%\n  |                                                                            \n  |==================================================                    |  72%\n  |                                                                            \n  |===================================================                   |  72%\n  |                                                                            \n  |===================================================                   |  73%\n  |                                                                            \n  |====================================================                  |  74%\n  |                                                                            \n  |====================================================                  |  75%\n  |                                                                            \n  |=====================================================                 |  76%\n  |                                                                            \n  |======================================================                |  77%\n  |                                                                            \n  |======================================================                |  78%\n  |                                                                            \n  |=======================================================               |  78%\n  |                                                                            \n  |=======================================================               |  79%\n  |                                                                            \n  |========================================================              |  80%\n  |                                                                            \n  |=========================================================             |  81%\n  |                                                                            \n  |=========================================================             |  82%\n  |                                                                            \n  |==========================================================            |  82%\n  |                                                                            \n  |==========================================================            |  83%\n  |                                                                            \n  |===========================================================           |  84%\n  |                                                                            \n  |============================================================          |  85%\n  |                                                                            \n  |============================================================          |  86%\n  |                                                                            \n  |=============================================================         |  87%\n  |                                                                            \n  |=============================================================         |  88%\n  |                                                                            \n  |==============================================================        |  88%\n  |                                                                            \n  |==============================================================        |  89%\n  |                                                                            \n  |===============================================================       |  90%\n  |                                                                            \n  |================================================================      |  91%\n  |                                                                            \n  |================================================================      |  92%\n  |                                                                            \n  |=================================================================     |  92%\n  |                                                                            \n  |=================================================================     |  93%\n  |                                                                            \n  |==================================================================    |  94%\n  |                                                                            \n  |==================================================================    |  95%\n  |                                                                            \n  |===================================================================   |  96%\n  |                                                                            \n  |====================================================================  |  97%\n  |                                                                            \n  |====================================================================  |  98%\n  |                                                                            \n  |===================================================================== |  98%\n  |                                                                            \n  |===================================================================== |  99%\n  |                                                                            \n  |======================================================================| 100%\n\n[1] \"Normalizing...\"\n```\n:::\n\n```{.r .cell-code}\n#write.csv(gsva_mat, \"gsva_go_matrix.csv\")\n\nssgsea_go <- gsva(expr = HeatdataDeseq2, \n                  gset.idx.list = go_list, \n                  kcdf = \"Poisson\", #\"Gaussian\" for logCPM, logRPKM, logTPM, \"Poisson\" for counts\n                  method = \"ssgsea\",\n                  verbose = TRUE\n                  #parallel.sz = parallel::detectCores() # Utilize all available cores\n)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Calling gsva(expr=., gset.idx.list=., method=., ...) is deprecated;\nuse a method-specific parameter object (see '?gsva').\nWarning: Some gene sets have size one. Consider setting 'min.sz > 1'.\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\nEstimating ssGSEA scores for 7997 gene sets.\n[1] \"Calculating ranks...\"\n[1] \"Calculating absolute values from ranks...\"\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |=                                                                     |   1%\n  |                                                                            \n  |=                                                                     |   2%\n  |                                                                            \n  |==                                                                    |   2%\n  |                                                                            \n  |==                                                                    |   3%\n  |                                                                            \n  |===                                                                   |   4%\n  |                                                                            \n  |====                                                                  |   5%\n  |                                                                            \n  |====                                                                  |   6%\n  |                                                                            \n  |=====                                                                 |   7%\n  |                                                                            \n  |=====                                                                 |   8%\n  |                                                                            \n  |======                                                                |   8%\n  |                                                                            \n  |======                                                                |   9%\n  |                                                                            \n  |=======                                                               |  10%\n  |                                                                            \n  |========                                                              |  11%\n  |                                                                            \n  |========                                                              |  12%\n  |                                                                            \n  |=========                                                             |  12%\n  |                                                                            \n  |=========                                                             |  13%\n  |                                                                            \n  |==========                                                            |  14%\n  |                                                                            \n  |==========                                                            |  15%\n  |                                                                            \n  |===========                                                           |  16%\n  |                                                                            \n  |============                                                          |  17%\n  |                                                                            \n  |============                                                          |  18%\n  |                                                                            \n  |=============                                                         |  18%\n  |                                                                            \n  |=============                                                         |  19%\n  |                                                                            \n  |==============                                                        |  20%\n  |                                                                            \n  |===============                                                       |  21%\n  |                                                                            \n  |===============                                                       |  22%\n  |                                                                            \n  |================                                                      |  22%\n  |                                                                            \n  |================                                                      |  23%\n  |                                                                            \n  |=================                                                     |  24%\n  |                                                                            \n  |==================                                                    |  25%\n  |                                                                            \n  |==================                                                    |  26%\n  |                                                                            \n  |===================                                                   |  27%\n  |                                                                            \n  |===================                                                   |  28%\n  |                                                                            \n  |====================                                                  |  28%\n  |                                                                            \n  |====================                                                  |  29%\n  |                                                                            \n  |=====================                                                 |  30%\n  |                                                                            \n  |======================                                                |  31%\n  |                                                                            \n  |======================                                                |  32%\n  |                                                                            \n  |=======================                                               |  32%\n  |                                                                            \n  |=======================                                               |  33%\n  |                                                                            \n  |========================                                              |  34%\n  |                                                                            \n  |========================                                              |  35%\n  |                                                                            \n  |=========================                                             |  36%\n  |                                                                            \n  |==========================                                            |  37%\n  |                                                                            \n  |==========================                                            |  38%\n  |                                                                            \n  |===========================                                           |  38%\n  |                                                                            \n  |===========================                                           |  39%\n  |                                                                            \n  |============================                                          |  40%\n  |                                                                            \n  |=============================                                         |  41%\n  |                                                                            \n  |=============================                                         |  42%\n  |                                                                            \n  |==============================                                        |  42%\n  |                                                                            \n  |==============================                                        |  43%\n  |                                                                            \n  |===============================                                       |  44%\n  |                                                                            \n  |================================                                      |  45%\n  |                                                                            \n  |================================                                      |  46%\n  |                                                                            \n  |=================================                                     |  47%\n  |                                                                            \n  |=================================                                     |  48%\n  |                                                                            \n  |==================================                                    |  48%\n  |                                                                            \n  |==================================                                    |  49%\n  |                                                                            \n  |===================================                                   |  50%\n  |                                                                            \n  |====================================                                  |  51%\n  |                                                                            \n  |====================================                                  |  52%\n  |                                                                            \n  |=====================================                                 |  52%\n  |                                                                            \n  |=====================================                                 |  53%\n  |                                                                            \n  |======================================                                |  54%\n  |                                                                            \n  |======================================                                |  55%\n  |                                                                            \n  |=======================================                               |  56%\n  |                                                                            \n  |========================================                              |  57%\n  |                                                                            \n  |========================================                              |  58%\n  |                                                                            \n  |=========================================                             |  58%\n  |                                                                            \n  |=========================================                             |  59%\n  |                                                                            \n  |==========================================                            |  60%\n  |                                                                            \n  |===========================================                           |  61%\n  |                                                                            \n  |===========================================                           |  62%\n  |                                                                            \n  |============================================                          |  62%\n  |                                                                            \n  |============================================                          |  63%\n  |                                                                            \n  |=============================================                         |  64%\n  |                                                                            \n  |==============================================                        |  65%\n  |                                                                            \n  |==============================================                        |  66%\n  |                                                                            \n  |===============================================                       |  67%\n  |                                                                            \n  |===============================================                       |  68%\n  |                                                                            \n  |================================================                      |  68%\n  |                                                                            \n  |================================================                      |  69%\n  |                                                                            \n  |=================================================                     |  70%\n  |                                                                            \n  |==================================================                    |  71%\n  |                                                                            \n  |==================================================                    |  72%\n  |                                                                            \n  |===================================================                   |  72%\n  |                                                                            \n  |===================================================                   |  73%\n  |                                                                            \n  |====================================================                  |  74%\n  |                                                                            \n  |====================================================                  |  75%\n  |                                                                            \n  |=====================================================                 |  76%\n  |                                                                            \n  |======================================================                |  77%\n  |                                                                            \n  |======================================================                |  78%\n  |                                                                            \n  |=======================================================               |  78%\n  |                                                                            \n  |=======================================================               |  79%\n  |                                                                            \n  |========================================================              |  80%\n  |                                                                            \n  |=========================================================             |  81%\n  |                                                                            \n  |=========================================================             |  82%\n  |                                                                            \n  |==========================================================            |  82%\n  |                                                                            \n  |==========================================================            |  83%\n  |                                                                            \n  |===========================================================           |  84%\n  |                                                                            \n  |============================================================          |  85%\n  |                                                                            \n  |============================================================          |  86%\n  |                                                                            \n  |=============================================================         |  87%\n  |                                                                            \n  |=============================================================         |  88%\n  |                                                                            \n  |==============================================================        |  88%\n  |                                                                            \n  |==============================================================        |  89%\n  |                                                                            \n  |===============================================================       |  90%\n  |                                                                            \n  |================================================================      |  91%\n  |                                                                            \n  |================================================================      |  92%\n  |                                                                            \n  |=================================================================     |  92%\n  |                                                                            \n  |=================================================================     |  93%\n  |                                                                            \n  |==================================================================    |  94%\n  |                                                                            \n  |==================================================================    |  95%\n  |                                                                            \n  |===================================================================   |  96%\n  |                                                                            \n  |====================================================================  |  97%\n  |                                                                            \n  |====================================================================  |  98%\n  |                                                                            \n  |===================================================================== |  98%\n  |                                                                            \n  |===================================================================== |  99%\n  |                                                                            \n  |======================================================================| 100%\n\n[1] \"Normalizing...\"\n```\n:::\n\n```{.r .cell-code}\n#write.csv(gsva_mat, \"gsva_go_matrix.csv\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Data transformation for GSVA of KEGG\n#### Differential analysis using limma ####\n\n# Assigning group labels for tumor and normal samples\ngroup <- c(rep('tumor', 60), rep('normal', 60))\ngroup <- factor(group, levels = c(\"normal\", \"tumor\"))\n\n# Constructing the design matrix\ndesign <- model.matrix(~0 + factor(group))\ncolnames(design) <- levels(factor(group))\nrownames(design) <- colnames(gsva_kegg)\n\n# Forming the contrast matrix for differential analysis\ncon <- paste(rev(levels(group)), collapse = \"-\")\ncont.matrix <- limma::makeContrasts(contrasts = c(con), levels = design)\n\n# Fitting the linear model\nfit <- limma::lmFit(gsva_kegg, design)\nfit2 <- limma::contrasts.fit(fit, cont.matrix)\nfit2 <- limma::eBayes(fit2)\n\n# Retrieving differential expression results\ntempOutput <- limma::topTable(fit2, coef = con, n = Inf)\ngsva_kegg_limma <- stats::na.omit(tempOutput)\n\n#### Visualization of differential analysis results from GSVA ####\n## Setting filtering thresholds\npadj_cutoff = 0.05\nlog2FC_cutoff = log2(2)\n\n# Filtering significant gene sets\nkeep <- rownames(gsva_kegg_limma[gsva_kegg_limma$adj.P.Val < padj_cutoff & abs(gsva_kegg_limma$logFC) > log2FC_cutoff, ])\nlength(keep)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 14\n```\n:::\n\n```{.r .cell-code}\n# Extracting the top 10 elements from the limma analysis results\nkeep_top10 <- keep[1:10]\n# Selecting rows in gsva_kegg that match the top 10 genes from keep\ngsva_kegg_limma_head10 <- gsva_kegg[rownames(gsva_kegg) %in% keep_top10, ]\n\n# Checking if row names are set, assuming the first column as row names if not set\nif (is.null(rownames(gsva_kegg_limma_head10))) {\n  gsva_kegg_limma_head10 <- gsva_kegg_limma_head10 %>%\n    mutate(RowID = row_number()) %>%  # Adding a row number for each row\n    column_to_rownames(var=\"RowID\")  # Setting this row number as row names\n}\n\ngsva_kegg_limma_head10 <- as.data.frame(gsva_kegg_limma_head10)\n\n# To preserve row names in the long format data, first convert row names into a column of the data frame\ngsva_kegg_limma_head10 <- gsva_kegg_limma_head10 %>%\n  tibble::rownames_to_column(var = \"Gene\")  # Convert row names to a column named Gene\n\n# Transforming the dataframe from wide to long format, including the newly added row names column\ngsva_kegg_HeatdataDeseq <- gsva_kegg_limma_head10 %>%\n  pivot_longer(\n    cols = -Gene,    # Transforming all columns except the Gene column\n    names_to = \"Sample\",  # Creating a new column to store the original column names\n    values_to = \"value\"   # Creating a new column to store the values\n  )\n\n# Displaying the transformed data\nprint(gsva_kegg_HeatdataDeseq)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1,200 × 3\n   Gene                                             Sample    value\n   <chr>                                            <chr>     <dbl>\n 1 KEGG_AMINO_SUGAR_AND_NUCLEOTIDE_SUGAR_METABOLISM TCGA_1   0.935 \n 2 KEGG_AMINO_SUGAR_AND_NUCLEOTIDE_SUGAR_METABOLISM TCGA_2   0.782 \n 3 KEGG_AMINO_SUGAR_AND_NUCLEOTIDE_SUGAR_METABOLISM TCGA_3  -0.0794\n 4 KEGG_AMINO_SUGAR_AND_NUCLEOTIDE_SUGAR_METABOLISM TCGA_4   0.257 \n 5 KEGG_AMINO_SUGAR_AND_NUCLEOTIDE_SUGAR_METABOLISM TCGA_5   0.565 \n 6 KEGG_AMINO_SUGAR_AND_NUCLEOTIDE_SUGAR_METABOLISM TCGA_6  -0.0225\n 7 KEGG_AMINO_SUGAR_AND_NUCLEOTIDE_SUGAR_METABOLISM TCGA_7   0.661 \n 8 KEGG_AMINO_SUGAR_AND_NUCLEOTIDE_SUGAR_METABOLISM TCGA_8   0.867 \n 9 KEGG_AMINO_SUGAR_AND_NUCLEOTIDE_SUGAR_METABOLISM TCGA_9   0.249 \n10 KEGG_AMINO_SUGAR_AND_NUCLEOTIDE_SUGAR_METABOLISM TCGA_10  0.753 \n# ℹ 1,190 more rows\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Subsetting the first 10 rows from HeatdataDeseq2\nHeatdataDeseq3 <- HeatdataDeseq2[1:10,]\n\n# Applying logarithmic transformation and converting to a data frame\nHeatdataDeseq3 <- as.data.frame(log_transform(HeatdataDeseq3))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"log2 transform finished\"\n```\n:::\n\n```{.r .cell-code}\n# Check if row names are set, if not, assume the first column as row names\nif (is.null(rownames(HeatdataDeseq3))) {\n  HeatdataDeseq3 <- HeatdataDeseq3 %>%\n    mutate(RowID = row_number()) %>%  # Add a row number to each row\n    column_to_rownames(var=\"RowID\")   # Set this row number as row names\n}\n\n# To retain row names in a long format, first convert row names to a column in the data frame\nHeatdataDeseq3 <- HeatdataDeseq3 %>%\n  tibble::rownames_to_column(var = \"Gene\")  # Convert row names to a column named 'Gene'\n\n# Transforming the data frame from wide to long format, including the newly added row name column\nlong_format_HeatdataDeseq <- HeatdataDeseq3 %>%\n  pivot_longer(\n    cols = -Gene,          # Transform all columns except for 'Gene'\n    names_to = \"Sample\",   # Create a new column to store original column names\n    values_to = \"value\"    # Create a new column to store values\n  )\n\n# Display the transformed data\nprint(long_format_HeatdataDeseq)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1,200 × 3\n   Gene  Sample  value\n   <chr> <chr>   <dbl>\n 1 A2M   TCGA_1   14.4\n 2 A2M   TCGA_2   15.1\n 3 A2M   TCGA_3   16.1\n 4 A2M   TCGA_4   18.8\n 5 A2M   TCGA_5   16.0\n 6 A2M   TCGA_6   18.6\n 7 A2M   TCGA_7   17.4\n 8 A2M   TCGA_8   13.0\n 9 A2M   TCGA_9   18.0\n10 A2M   TCGA_10  13.3\n# ℹ 1,190 more rows\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Selecting the top 10 rows from ssgsea_kegg for display\nssgsea_kegg_head10 <- as.data.frame(ssgsea_kegg[1:10,])\n\n# Check if row names are set, if not, assume the first column as row names\nif (is.null(rownames(ssgsea_kegg_head10))) {\n  ssgsea_kegg_head10 <- ssgsea_kegg_head10 %>%\n    mutate(RowID = row_number()) %>%  # Add a row number to each row\n    column_to_rownames(var=\"RowID\")   # Set this row number as row names\n}\n\nssgsea_kegg_head10 <- as.data.frame(ssgsea_kegg_head10)\n\n# To preserve row names in the long format data, first convert row names into a column of the data frame\nssgsea_kegg_head10 <- ssgsea_kegg_head10 %>%\n  tibble::rownames_to_column(var = \"Gene\")  # Convert row names to a column named Gene\n\n# Transforming the data frame from wide to long format, including the newly added row name column\nssgsea_kegg_HeatdataDeseq <- ssgsea_kegg_head10 %>%\n  pivot_longer(\n    cols = -Gene,          # Transform all columns except for 'Gene'\n    names_to = \"Sample\",   # Create a new column to store original column names\n    values_to = \"value\"    # Create a new column to store values\n  )\n\n# Display the transformed data\nprint(ssgsea_kegg_HeatdataDeseq)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1,200 × 3\n   Gene                  Sample   value\n   <chr>                 <chr>    <dbl>\n 1 KEGG_ABC_TRANSPORTERS TCGA_1  0.181 \n 2 KEGG_ABC_TRANSPORTERS TCGA_2  0.207 \n 3 KEGG_ABC_TRANSPORTERS TCGA_3  0.178 \n 4 KEGG_ABC_TRANSPORTERS TCGA_4  0.258 \n 5 KEGG_ABC_TRANSPORTERS TCGA_5  0.218 \n 6 KEGG_ABC_TRANSPORTERS TCGA_6  0.237 \n 7 KEGG_ABC_TRANSPORTERS TCGA_7  0.0993\n 8 KEGG_ABC_TRANSPORTERS TCGA_8  0.245 \n 9 KEGG_ABC_TRANSPORTERS TCGA_9  0.178 \n10 KEGG_ABC_TRANSPORTERS TCGA_10 0.212 \n# ℹ 1,190 more rows\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nvalues=c(\"#491588\", \"#301b8d\", \"#1a237a\", \"#11479c\", \"#0a5797\",\"#0b5f63\",\"#074d41\",\"#1f5e27\",\"#366928\",\"#827729\",\"#f28131\",\"#fc7226\",\"#e3551e\",\"#bd3a1b\", \"#c62828\", \"#ad1457\", \"#6a1b9a\")\nrow.names(HeatdataDeseq3)<- HeatdataDeseq3$Gene\nHeatdataDeseq3$Gene <- NULL\niindata<-as.data.frame(t(HeatdataDeseq3))\nheatdata.clust_new<-hclust(dist(iindata,method = \"euclidean\"),method = \"complete\")\n\np1=ggtree(heatdata.clust_new,branch.length='none',layout=\"circular\",size=0.3, xlim=c(30,NA))\n#p1\np2<-p1+geom_text(aes(label=node))##watch node\np2\n```\n\n::: {.cell-output-display}\n![](Circos-Fruit_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\np1<-p1+geom_hilight(node=137, fill = \"#491588\", alpha = .4, extend =107)+\n  geom_hilight(node=157, fill = \"#1976d2\", alpha = .3, extend =107)+\n  geom_hilight(node=161, fill = \"#1976d2\", alpha = .3, extend =106)+\n  geom_hilight(node=179, fill = \"#388e3c\", alpha = .4, extend =107)+\n  geom_hilight(node=127, fill = \"#f9a825\", alpha = .3, extend =107)+\n  geom_hilight(node=150, fill = \"#491588\", alpha = .4, extend =105)+\n  geom_hilight(node=128, fill = \"#1976d2\", alpha = .3, extend =107)+\n  geom_hilight(node=189, fill = \"#388e3c\", alpha = .4, extend =105)+\n  geom_hilight(node=131, fill = \"#f9a825\", alpha = .3, extend =106)\n\np1\n```\n\n::: {.cell-output-display}\n![](Circos-Fruit_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngene_colors <- c(\"#491588\", \"#301b8d\", \"#1a237a\", \"#11479c\", \"#0a5797\",\"#0b5f63\",\"#074d41\",\"#1f5e27\",\"#366928\",\"#827729\")\np2 <- create_base_plot(p1, long_format_HeatdataDeseq, gene_colors)\np2\n```\n\n::: {.cell-output-display}\n![](Circos-Fruit_files/figure-html/unnamed-chunk-10-1.png){width=100%}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Add a boxplot layer to the base plot\np3 <- add_boxplot(p2, long_format_HeatdataDeseq)\np3\n```\n\n::: {.cell-output-display}\n![](Circos-Fruit_files/figure-html/unnamed-chunk-11-1.png){width=100%}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngene_colors <- c(\"#491588\", \"#301b8d\", \"#1a237a\", \"#11479c\", \"#0a5797\",\"#0b5f63\",\"#074d41\",\"#1f5e27\",\"#366928\",\"#827729\")\n# Add a new tile layer for SSGSEA data\np4 <- add_new_tile_layer(p3, ssgsea_kegg_HeatdataDeseq, gene_colors, \"Ssgsea Term\")\np4\n```\n\n::: {.cell-output-display}\n![](Circos-Fruit_files/figure-html/unnamed-chunk-12-1.png){width=100%}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Add another boxplot layer with specific aesthetic adjustments\np5 <- add_boxplot(p4, ssgsea_kegg_HeatdataDeseq, fill_color=\"#f28131\", alpha=0.65, offset=0.32)\np5\n```\n\n::: {.cell-output-display}\n![](Circos-Fruit_files/figure-html/unnamed-chunk-13-1.png){width=100%}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngene_colors <- c(\"#491588\", \"#301b8d\", \"#1a237a\", \"#11479c\", \"#0a5797\",\"#0b5f63\",\"#074d41\",\"#1f5e27\",\"#366928\",\"#827729\")\n# Add a new tile layer for GSVA data with specific alpha and offset adjustments\np6 <- add_new_tile_layer(p5, gsva_kegg_HeatdataDeseq, gene_colors, \"Gsva Term\", alpha_value=c(0.3, 0.9), offset=0.02)\np6\n```\n\n::: {.cell-output-display}\n![](Circos-Fruit_files/figure-html/unnamed-chunk-14-1.png){width=100%}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngene_colors <- c(\"#491588\", \"#301b8d\", \"#1a237a\", \"#11479c\", \"#0a5797\",\"#0b5f63\",\"#074d41\",\"#1f5e27\",\"#366928\",\"#827729\")\np7 <- circos_fruits(p1,\n                            long_format_HeatdataDeseq,\n                            ssgsea_kegg_HeatdataDeseq,\n                            gsva_kegg_HeatdataDeseq,\n                            gene_colors)\np_final <- p7 + geom_strip(25, 114, label=\"TCGA_GTEX\", offset=100, barsize=2, extend=1, color=\"#9575cd\", alpha=0.5, hjust=\"center\", align=TRUE, offset.text=19, angle=-90)\nprint(p_final)\n```\n\n::: {.cell-output-display}\n![](Circos-Fruit_files/figure-html/unnamed-chunk-15-1.png){width=100%}\n:::\n:::\n\n\n## Reference\n>\n> - **ggplot2**:\n> \n>><a href=\"https://github.com/tidyverse/ggplot2\" style=\"color: #758b76; font-weight: bold;\">github:ggplot2</a>\n>>\n>><a href=\"https://ggplot2.tidyverse.org/\" style=\"color: #758b76; font-weight: bold;\">An implementation of the Grammar of Graphics in R</a>\n>\n> - **ggtreeExtra**:\n> \n>><a href=\"https://doi.org/10.1093/molbev/msab166\" style=\"color: #758b76; font-weight: bold;\">S Xu, Z Dai, P Guo, X Fu, S Liu, L Zhou, W Tang, T Feng, M Chen, L Zhan, T Wu, E Hu, Y Jiang*, X Bo* and G Yu*. ggtreeExtra: Compact visualization of richly annotated phylogenetic data. Molecular Biology and Evolution. 2021, 38(9):4039-4042. </a>\n>\n> - **ggtree**:\n> \n>><a href=\"https://doi.org/10.1111/2041-210X.12628\" style=\"color: #758b76; font-weight: bold;\">G Yu, DK Smith, H Zhu, Y Guan, TTY Lam*. ggtree: an R package for visualization and annotation of phylogenetic trees with their covariates and other associated data. Methods in Ecology and Evolution. 2017, 8(1):28-36.</a>\n>\n> - **clusterProfiler 4.0**:\n> \n>><a href=\"https://doi.org/10.1016/j.xinn.2021.100141\" style=\"color: #758b76; font-weight: bold;\">T Wu#, E Hu#, S Xu, M Chen, P Guo, Z Dai, T Feng, L Zhou, W Tang, L Zhan, X Fu, S Liu, X Bo*, G Yu*. clusterProfiler 4.0: A universal enrichment tool for interpreting omics data. The Innovation. 2021, 2(3):100141. </a>\n> ",
    "supporting": [
      "Circos-Fruit_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}