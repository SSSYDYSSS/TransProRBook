{
  "hash": "eb9b0bcff3572b56fd85c12e53b121c9",
  "result": {
    "markdown": "# Remove Batch Effect\n\n::: {.callout-note}\n\n- The output is a dataframe that has been back-transformed from $\\log_{2}$, with integers retained.\n\n- Users <b style=\"color: #6a926b;\">do not</b> need to input parameters like <b style=\"color: #6a926b;\">auto_mode</b> and <b style=\"color: #6a926b;\">default_input</b>. During the function execution, there will be interactive outputs. Users can choose sample types that are more numerous and filter out samples that are less numerous. This prevents the noise from individual data points from being too large or affecting batch correction.\n\n- <b style=\"color: #6a926b;\">Please pay special attention!</b> The primary purpose of the examples in this chapter is merely to illustrate using public data. However, in actual applications, different batches and groupings might vary. The premise for batch correction in the functions shown in this chapter is based on a broad assumption that different tumor types have different batches. Users can replace it based on their actual situation.\n\n- If the database lacks the target sample type, users can input <b style=\"color: #6a926b;\"> \"skip\"</b> in the default_input parameter of the Combat_Normal function.\n:::\n\n::: {.callout-tip}\n\n- The ComBat_seq function called within requires the input data to be in <b style=\"color: #6a926b;\">matrix form</b>, not a dataframe. If users want to change the function settings, they should take note of this key point during the modification.\n\n- The function converts the result back to a <b style=\"color: #6a926b;\">dataframe</b> for the output, making it convenient for users' subsequent data analysis.\n\n- The batch and group parameters inside the function are <b style=\"color: #6a926b;\">vectors</b>. Users can directly set these vectors, but they must ensure they are <b style=\"color: #6a926b;\">consistent with the order of the count samples.</b>\n\n- Numbers 01 to 09 represent different types of tumor samples, and 10 to 19 represent different types of normal samples.\n\n- 01 (primary solid tumors) and 11 (normal solid tissues) are the most common, while 06 represents metastasis.\n\n- It is generally recommended that users select 01, 06, and 11 during interaction. The decision to choose other numbers depends on the specific situation. <b style=\"color: #6a926b;\">Types with too few samples might contribute more noise than value to the overall data, making them less meaningful. They are not suitable for batch correction and are therefore not recommended for selection.</b>\n:::\n\n## Different tumor types in TCGA\n\n\n\n\n\n### SKCM_combat_count\n\n::: {.cell}\n\n```{.r .cell-code}\nSKCM_combat_count <- combat_tumor(\n    tumor_data_path = \"../test_TransProR/generated_data1/SKCM_Skin_TCGA_exp_tumor.rds\", \n    CombatTumor_output_path = \"../test_TransProR/generated_data1/removebatch_SKCM_Skin_TCGA_exp_tumor.rds\",\n    auto_mode = T,\n    default_input = \"01,06\"\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nTumorHistologicalTypes\n 01  06  07 \n103 367   1 \nFound 2 batches\nUsing null model in ComBat-seq.\nAdjusting for 0 covariate(s) or covariate level(s)\nEstimating dispersions\nFitting the GLM model\nShrinkage off - using GLM estimates for parameters\nAdjusting the data\n```\n:::\n\n```{.r .cell-code}\nhead(SKCM_combat_count)[1:5, 1:5]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n         TCGA-D9-A4Z2-01A TCGA-ER-A2NH-06A TCGA-BF-A5EO-01A TCGA-D9-A6EA-06A\nTSPAN6               5707             1447             1049             1636\nTNMD                    0                2                0                2\nDPM1                 2201             1296              624             2482\nSCYL3                1261              524              307              714\nC1orf112             1107              373              295              564\n         TCGA-D9-A4Z3-01A\nTSPAN6               1511\nTNMD                    0\nDPM1                 1180\nSCYL3                 522\nC1orf112              557\n```\n:::\n:::\n\n\n### BRCA_combat_count\n\n::: {.cell}\n\n```{.r .cell-code}\nBRCA_combat_count <- combat_tumor(\n    tumor_data_path = \"../test_TransProR/generated_data1/BRCA_Breast_TCGA_exp_tumor.rds\", \n    CombatTumor_output_path = \"../test_TransProR/generated_data1/removebatch_BRCA_Breast_TCGA_exp_tumor.rds\",\n    auto_mode = T,\n    default_input = \"01\"\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nTumorHistologicalTypes\n  01   06 \n1097    7 \n```\n:::\n\n```{.r .cell-code}\nhead(BRCA_combat_count)[1:5, 1:5]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n         TCGA-A2-A0CY-01A TCGA-B6-A40B-01A TCGA-AO-A0J8-01A TCGA-A8-A08J-01A\nTSPAN6               3166             3886             3878             2366\nTNMD                    0               41               32                7\nDPM1                 1259             2126             2146             4987\nSCYL3                1123             2112             4348             2843\nC1orf112              445              681             1311              506\n         TCGA-E2-A14N-01A\nTSPAN6               2701\nTNMD                   11\nDPM1                 2439\nSCYL3                 936\nC1orf112             1221\n```\n:::\n:::\n\n\n### LGG_combat_count\n\n::: {.cell}\n\n```{.r .cell-code}\nLGG_combat_count <- combat_tumor(\n    tumor_data_path = \"../test_TransProR/generated_data1/LGG_Brain_TCGA_exp_tumor.rds\", \n    CombatTumor_output_path = \"../test_TransProR/generated_data1/removebatch_LGG_Brain_TCGA_exp_tumor.rds\",\n    auto_mode = T,\n    default_input = \"01\"\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nTumorHistologicalTypes\n 01 \n511 \n```\n:::\n\n```{.r .cell-code}\nhead(LGG_combat_count)[1:5, 1:5]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n         TCGA-VM-A8C8-01A TCGA-VV-A829-01A TCGA-DH-5141-01A TCGA-RY-A840-01A\nTSPAN6               1779             2776             3708             2284\nTNMD                    0                2               17                1\nDPM1                 1049             1102             1119              951\nSCYL3                 447              757              522              565\nC1orf112              193              276              113              155\n         TCGA-DB-A64V-01A\nTSPAN6               2704\nTNMD                    3\nDPM1                 1170\nSCYL3                 550\nC1orf112              191\n```\n:::\n:::\n\n\n### THCA_combat_count\n\n::: {.cell}\n\n```{.r .cell-code}\nTHCA_combat_count<-combat_tumor(\n    tumor_data_path = \"../test_TransProR/generated_data1/THCA_Thyroid_TCGA_exp_tumor.rds\", \n    CombatTumor_output_path = \"../test_TransProR/generated_data1/removebatch_THCA_Thyroid_TCGA_exp_tumor.rds\",\n    auto_mode = T,\n    default_input = \"01\"\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nTumorHistologicalTypes\n 01  06 \n502   8 \n```\n:::\n\n```{.r .cell-code}\nhead(THCA_combat_count)[1:5, 1:5]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n         TCGA-BJ-A28W-01A TCGA-EM-A1CT-01A TCGA-EL-A4JZ-01A TCGA-EL-A3CT-01A\nTSPAN6               1044             1271             2474             4254\nTNMD                    3                0                1                7\nDPM1                 1134              715             1668             1746\nSCYL3                 451              623              772              545\nC1orf112              122              165              225              196\n         TCGA-ET-A2MY-01A\nTSPAN6               2471\nTNMD                    0\nDPM1                 1726\nSCYL3                1048\nC1orf112              240\n```\n:::\n:::\n\n\n## GTEX and TGCA's normal tissue\n### SKCM_Skin_Combat_Normal_TCGA_GTEX_count\n\n::: {.cell}\n\n```{.r .cell-code}\nSKCM_Skin_Combat_Normal_TCGA_GTEX_count <- Combat_Normal(\n    TCGA_normal_data_path = \"../test_TransProR/generated_data1/SKCM_Skin_TCGA_exp_normal.rds\", \n    gtex_data_path = '../test_TransProR/generated_data1/Skin_SKCM_Gtex.rds', \n    CombatNormal_output_path = '../test_TransProR/generated_data1/removebatch_SKCM_Skin_Normal_TCGA_GTEX_count.rds',\n    auto_mode = T,\n    default_input = \"skip\"\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nNormalHistologicalTypes\n11 \n 1 \n```\n:::\n\n```{.r .cell-code}\nhead(SKCM_Skin_Combat_Normal_TCGA_GTEX_count)[1:5, 1:5]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n         GTEX-111CU-1126-SM-5EGIM GTEX-111CU-1926-SM-5GZYZ\nTSPAN6                        249                      827\nTNMD                            8                       87\nDPM1                          363                      656\nSCYL3                         287                      799\nC1orf112                       72                      264\n         GTEX-111FC-0126-SM-5N9DL GTEX-111FC-2526-SM-5GZXU\nTSPAN6                        269                      455\nTNMD                          109                      177\nDPM1                          822                      532\nSCYL3                        1079                      614\nC1orf112                      237                      191\n         GTEX-111VG-0008-SM-5Q5BG\nTSPAN6                        434\nTNMD                            0\nDPM1                         1031\nSCYL3                         254\nC1orf112                      275\n```\n:::\n:::\n\n\n### BRCA_Breast_Combat_Normal_TCGA_GTEX_count\n\n::: {.cell}\n\n```{.r .cell-code}\nBRCA_Breast_Combat_Normal_TCGA_GTEX_count <- Combat_Normal(\n    TCGA_normal_data_path = \"../test_TransProR/generated_data1/BRCA_Breast_TCGA_exp_normal.rds\", \n    gtex_data_path = '../test_TransProR/generated_data1/Breast_BRCA_Gtex.rds', \n    CombatNormal_output_path = '../test_TransProR/generated_data1/removebatch_BRCA_Breast_Normal_TCGA_GTEX_count.rds',\n    auto_mode = T,\n    default_input = \"11\"\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nNormalHistologicalTypes\n 11 \n113 \nFound 2 batches\nUsing null model in ComBat-seq.\nAdjusting for 0 covariate(s) or covariate level(s)\nEstimating dispersions\nFitting the GLM model\nShrinkage off - using GLM estimates for parameters\nAdjusting the data\n```\n:::\n\n```{.r .cell-code}\nhead(BRCA_Breast_Combat_Normal_TCGA_GTEX_count)[1:5, 1:5]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n          TCGA-BH-A1F0-11B TCGA-BH-A0BZ-11A TCGA-AC-A2FM-11B TCGA-BH-A0HA-11A\n5_8S_rRNA                0                0                0                0\n5S_rRNA                  0                0                0                0\n7SK                      0                0                0                0\nA1BG                   113               41              246              175\nA1BG-AS1               250              147              381              239\n          TCGA-BH-A1FU-11A\n5_8S_rRNA                0\n5S_rRNA                  0\n7SK                      0\nA1BG                   147\nA1BG-AS1               150\n```\n:::\n:::\n\n\n### LGG_Brain_Combat_Normal_TCGA_GTEX_count \n\n::: {.cell}\n\n```{.r .cell-code}\nLGG_Brain_Combat_Normal_TCGA_GTEX_count <- Combat_Normal(\n    TCGA_normal_data_path = \"../test_TransProR/generated_data1/LGG_Brain_TCGA_exp_normal.rds\", \n    gtex_data_path = '../test_TransProR/generated_data1/Brain_LGG_Gtex.rds', \n    CombatNormal_output_path = '../test_TransProR/generated_data1/removebatch_LGG_Brain_Normal_TCGA_GTEX_count.rds',\n    auto_mode = T,\n    default_input = \"skip\"\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n< table of extent 0 >\n```\n:::\n\n```{.r .cell-code}\nhead(LGG_Brain_Combat_Normal_TCGA_GTEX_count)[1:5, 1:5]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n         GTEX-1117F-3226-SM-5N9CT GTEX-111FC-3126-SM-5GZZ2\nTSPAN6                        645                      241\nTNMD                            3                        5\nDPM1                          400                      527\nSCYL3                         188                      421\nC1orf112                      112                      158\n         GTEX-111FC-3326-SM-5GZYV GTEX-1128S-2726-SM-5H12C\nTSPAN6                        120                      261\nTNMD                            0                        3\nDPM1                          354                      456\nSCYL3                         390                      256\nC1orf112                      300                       94\n         GTEX-1128S-2826-SM-5N9DI\nTSPAN6                         57\nTNMD                            0\nDPM1                          305\nSCYL3                         217\nC1orf112                      245\n```\n:::\n:::\n\n\n### THCA_Thyroid_Combat_Normal_TCGA_GTEX_count\n\n::: {.cell}\n\n```{.r .cell-code}\nTHCA_Thyroid_Combat_Normal_TCGA_GTEX_count <- Combat_Normal(\n    TCGA_normal_data_path = \"../test_TransProR/generated_data1/THCA_Thyroid_TCGA_exp_normal.rds\", \n    gtex_data_path = '../test_TransProR/generated_data1/Thyroid_THCA_Gtex.rds', \n    CombatNormal_output_path = '../test_TransProR/generated_data1/removebatch_THCA_Thyroid_Normal_TCGA_GTEX_count.rds',\n    auto_mode = T,\n    default_input = \"11\"\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nNormalHistologicalTypes\n11 \n58 \nFound 2 batches\nUsing null model in ComBat-seq.\nAdjusting for 0 covariate(s) or covariate level(s)\nEstimating dispersions\nFitting the GLM model\nShrinkage off - using GLM estimates for parameters\nAdjusting the data\n```\n:::\n\n```{.r .cell-code}\nhead(THCA_Thyroid_Combat_Normal_TCGA_GTEX_count)[1:5, 1:5]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n          TCGA-BJ-A28W-11A TCGA-EM-A1CT-11A TCGA-EL-A3MX-11A TCGA-DO-A1JZ-11A\n5_8S_rRNA                0                0                0                0\n5S_rRNA                  0                0                0                0\n7SK                      0                0                0                0\nA1BG                   203              233              206              148\nA1BG-AS1               240              323              360              324\n          TCGA-EL-A3TA-11A\n5_8S_rRNA                0\n5S_rRNA                  0\n7SK                      0\nA1BG                   154\nA1BG-AS1               249\n```\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}